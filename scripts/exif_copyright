#!/bin/bash
# Written by Ben Vreeland
# Writes copyright info to image files using exiftool

# Assume the author is me if no name is passed in
if [ "$1" ]; then
	author="$1"
else
	author="Ben Vreeland"
fi

shopt -s globstar nullglob nocaseglob
total=0
for f in **/*.{jpg,jpeg,tif,tiff,dng,cr2,nef}; do
	if [ "$f" ]; then
		fshort=${f##*/}
		year=$(exiftool -s3 -d '%Y' -DateTimeOriginal "$f")
		if [ "$year" ]; then
			yearpad=$year" "
		elif [[ ${fshort} =~ ^[0-9]{8}_ ]]; then
			year=${fshort:0:4}
			yearpad=$year" "
		fi

		exiftool \
			-q \
			-overwrite_original \
			-Copyright="$yearpad$author" \
			-CopyrightNotice="Copyright $yearpad$author" \
			-XPAuthor="$author" \
			-Artist="$author" \
			-Creator="$author" \
			-xmp:CopyrightYear=$year \
			-xmp:ArtworkCopyrightNotice="Copyright $yearpad$author" \
			-Comment="Copyright $yearpad$author" \
			"$f"

		echo "updated $f"
		total=$(( $total + 1 ))
		year=""
		yearpad=""
	fi
done

echo -e "\n$total files updated for $author"
